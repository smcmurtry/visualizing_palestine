<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
  <script src="queue.js"></script>
  // <script src="scroller.js"></script>
  <title>The Israeli ID System - Interactive</title>
  <meta name="description" content="The Israeli ID System - Interactive">
    <!-- <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/> -->
  <link rel="stylesheet" type="text/css" href="scroller.css"/>

</head>

<body>
<div class="container">
  <div id='graphic'>
    <div id='sections'>
      <section class="step">
        <div class="title">Jewish Israeli Citizens</div>
        Free to live throughout Israel and 60% of the occupied West Bank.
      </section>
      <section class="step">
        <div class="title">Palestinian Citizens of Israel</div>
        Barred from living in 68% of all towns in Israel by admissions committees.
      </section>
      <section class="step">
        <div class="title">East Jerusalem Palestinians</div>
        Access to most areas, but ID may be revoked if living outside of Jerusalem.
      </section>
      <section class="step">
        <div class="title">West Bank Palestinians</div>
        Barred from living in all but 40% of West Bank due to Israeli settler and military presence.
      </section>
      <section class="step">
        <div class="title">Gaza Strip Palestinians</div>
        Barred from living outside of Gaza since 2007.
      </section>
      <section class="step">
        <div class="title">Palestinian Exiles</div>
        Barred from returning to live anywhere in Israel or Palestinian territory.
      </section>
    </div>
    <div id='vis'>
    </div>
    <div id="extra-space">
    </div>
  </div>
</div>
</body>


<script>
// using this tutorial: http://vallandingham.me/scroll_demo/

function a() {
  //
}

var activateFunctions = [];
activateFunctions[0] = a;
activateFunctions[1] = a;
activateFunctions[2] = a;
activateFunctions[3] = a;
activateFunctions[4] = a;
activateFunctions[5] = a;

var scrollVis = function() {
  var width = 600;
  var height = 520;
  var margin = {top:0, left:20, bottom:40, right:10};
  var lastIndex = -1;
  var activeIndex = 0;

  var chart = function(selection) {
    selection.each(function(rawData) {
      setupSections();
    });
  };

  chart.activate = function(index) {
    activeIndex = index;
    var sign = (activeIndex - lastIndex) < 0 ? -1 : 1;
    var scrolledSections = d3.range(lastIndex + sign, activeIndex + sign, sign);
    scrolledSections.forEach(function(i) {
      console.log(i)
      activateFunctions[i]();
    });
    lastIndex = activeIndex;
  };
  // return chart function
  return chart;
}

function display(data) {
  // create a new plot and
  // display it
  var plot = scrollVis();
  // d3.select("#vis")
    // .datum(data)
    // .call(plot);

  // setup scroll functionality
  var scroll = scroller()
    .container(d3.select('#graphic'));

  // pass in .step selection as the steps
  scroll(d3.selectAll('.step'));

  // setup event handling
  scroll.on('active', function(index) {
    // highlight current step text
    d3.selectAll('.step')
      .style('opacity',  function(d,i) { return i == index ? 1 : 0.1; });

    // activate current section
    plot.activate(index);
  });

}

display([]);



</script>